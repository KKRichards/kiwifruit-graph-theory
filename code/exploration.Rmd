---
title: "kiwifruit graph theory"
author: "Patrick Snelgar"
date: "`r {format(Sys.Date(), '%d %M %Y')}`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(tidygraph)
library(tidyverse)
library(ggraph)
library(magrittr)
#library(igraph)
#library(gganimate)
library(htmlwidgets)
library(plotly)
library(ggplot2)
library(gplots)
library(lubridate)
library(scales)

source("code/theme.R")

# checking for output folder
if(!dir.exists("output"))
	dir.create("output")

if(!dir.exists("workspace"))
	dir.create("workspace")
```


```{r misc_data_import, echo = FALSE}

quadrant_info <- read_csv("input/quadrant_info.csv") %>%
					mutate(QuadrantFromLeader = rep(c(3:1, 1:3), 6), 
						   QuadrantFromTrunk = rep(c(3:1, 1:3), each = 6),
						   EastWest = rep(rep(
					   						  c("W", "E"), 
					   						  each = 3
					   						  ),
						   			   	  6),
						   NorthSouth = rep(c("S", "N"), each = 18)
						   )

quadrant_labels <- data.frame(x = rep(c(-1250, -750, -250, 250, 750, 1250), each = 6),
							  y = rep(c(2500, 1500, 500, -500, -1500, -2500), 6),
							  label = 1:36)

flowering_dates <- read_csv("input/flowering_dates.csv") %>%
					mutate(FloweringColour = tolower(FloweringColour),
						   FloweringDate = dmy(FloweringDate))

```

```{r vine_data_import, echo = FALSE}
redo <- TRUE

seed_counts <- read_csv("input/fruit_data/seed_counts.csv") %>%
				rename(SampleID = 1,
					   TrayPosition = 2,
					   TrayID = 3,
					   FruitID = 4,
					   SubsampleSeed = 5,
					   TotalSeedWeight = 6,
					   AverageSeedCount = 7,
					   SeedComments = 8) %>%
				mutate(FruitID = gsub("([1-9])([0-9]*)", "\\1-\\2", FruitID))

if(!file.exists("workspace/all_fruit_data.csv") || !file.exists("workspace/all_arch_data.csv") || redo){
	
	##### CLEAN THIS SHIT UP ######
	# source("code/data_import/vine1_import.R")
	# source("code/data_import/vine2_import.R")
	# source("code/data_import/vine3_import.R")
	# source("code/data_import/vine4_import.R")
	# source("code/data_import/vine5_import.R")
	# source("code/data_import/vine6_import.R")
	# source("code/data_import/vine7_import.R")
	# source("code/data_import/vine8_import.R")
	# source("code/data_import/vine9_import.R")
	# 
	
	source("code/merge_vine_data.R")
	
	all_fruit_data %<>%
		mutate(FruitUUID = gsub("([1-9])([0-9]*)", "\\1-\\2", FruitUUID))%>%
		left_join(select(seed_counts, 1:8), by = c("FruitUUID" = "FruitID"))
	
	write_csv(all_fruit_data, "workspace/all_fruit_data.csv")
	write_csv(all_arch_data, "workspace/all_arch_data.csv")
	
} else {
	all_fruit_data <- read_csv("workspace/all_fruit_data.csv")
	all_arch_data <- read_csv("workspace/all_arch_data.csv")
}


```

```{r functions, echo = FALSE}

# maximum 9 fruit per shoot
angle <- 2 * pi / 9

pointXOffset <- function (central_xpoint, radius, point_pos){
	return(central_xpoint + radius * cos(point_pos * angle))
}

pointYOffset <- function (central_ypoint, radius, point_pos){
	return(central_ypoint + radius * sin(point_pos * angle))
}

```

```{r all_vines_plot, echo = FALSE}

source("code/sources/visualisation/all_vines_fruit_metrics.R")

```


```{r vine1_visualisation, echo=FALSE}

source("code/sources/visualisation/vine1_visualisation.R")

```

```{r vine2_visualisation, echo=FALSE}

source("code/sources/visualisation/vine2_visualisation.R")

```

```{r vine3_visualisation, echo=FALSE}

source("code/sources/visualisation/vine3_visualisation.R")

```

```{r vine4_visualisation, echo=FALSE}

source("code/sources/visualisation/vine4_visualisation.R")

```

```{r vine5_visualisation, echo=FALSE}

source("code/sources/visualisation/vine5_visualisation.R")

```

```{r vine6_visualisation, echo=FALSE}

source("code/sources/visualisation/vine6_visualisation.R")

```

```{r vine7_visualisation, echo=FALSE}

source("code/sources/visualisation/vine_visualisation7.R")

```

```{r vine8_visualisation, echo=FALSE}

source("code/sources/visualisation/vine8_visualisation.R")

```

```{r vine9_visualisation, echo=FALSE}

source("code/sources/visualisation/vine9_visualisation.R")

```
